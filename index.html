import React, { useState, useEffect, useMemo } from 'react';
import { Leaf, Droplets, Zap, Trophy, ShoppingCart, Wallet, Heart, Clock, Sparkles, TrendingUp, Crown, CheckCircle, Gift, Star, Bot, Info, Users, Share2, X, Box } from 'lucide-react';

/**
 * –ö–û–ù–°–¢–ê–ù–¢–´ –≠–ö–û–ù–û–ú–ò–ö–ò
 * –ë–∞–ª–∞–Ω—Å: 1 –ª–∏—Å—Ç–æ–∫ –≤ —Å—É—Ç–∫–∏ –±–∞–∑–æ–≤–æ.
 */
const DAY_IN_MS = 86400000;
const DAY_IN_SECONDS = 86400;
const INITIAL_POINTS = 0;
const BASE_DAILY_RATE = 1; 

/**
 * –ö–û–ú–ü–û–ù–ï–ù–¢ –†–ê–°–¢–ï–ù–ò–Ø
 * –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π –±–∞–∑–∏–ª–∏–∫, –ª–∏—Å—Ç—å—è —Å–º–æ—Ç—Ä—è—Ç –≤–≤–µ—Ä—Ö.
 */
const BasilPlantSVG = () => (
  <svg width="220" height="220" viewBox="0 0 240 240" fill="none" xmlns="http://www.w3.org/2000/svg" className="drop-shadow-2xl">
    <defs>
      <linearGradient id="leafGrad" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" stopColor="#bbf7d0" /><stop offset="50%" stopColor="#22c55e" /><stop offset="100%" stopColor="#15803d" />
      </linearGradient>
    </defs>
    <path d="M120 220 C 120 220, 118 180, 120 120" stroke="#3f6212" strokeWidth="6" strokeLinecap="round" />
    <path d="M115 190 C 80 200, 30 180, 25 140 C 20 100, 80 110, 115 180" fill="url(#leafGrad)" />
    <path d="M125 190 C 160 200, 210 180, 215 140 C 220 100, 160 110, 125 180" fill="url(#leafGrad)" />
    <path d="M118 160 C 90 140, 55 120, 60 80 C 65 40, 105 80, 115 150" fill="url(#leafGrad)" />
    <path d="M122 160 C 150 140, 185 120, 180 80 C 175 40, 135 80, 125 150" fill="url(#leafGrad)" />
    <path d="M120 130 C 105 110, 100 70, 120 40 C 140 70, 135 110, 120 130Z" fill="#4ade80" />
  </svg>
);

const App = () => {
  // --- –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ ---
  const [points, setPoints] = useState(() => Number(localStorage.getItem('basil_points')) || INITIAL_POINTS);
  const [dailyRate, setDailyRate] = useState(() => Number(localStorage.getItem('basil_daily_rate')) || BASE_DAILY_RATE);
  const [autoWaterLevel, setAutoWaterLevel] = useState(() => Number(localStorage.getItem('basil_water_lvl')) || 0);
  const [isSupporter, setIsSupporter] = useState(() => localStorage.getItem('basil_is_supporter') === 'true');
  const [isKing, setIsKing] = useState(() => localStorage.getItem('basil_is_king') === 'true');
  const [multiplier, setMultiplier] = useState(() => Number(localStorage.getItem('basil_multiplier')) || 1);
  
  // --- –°–æ—Å—Ç–æ—è–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ –∏ —Ç–∞–π–º–µ—Ä–æ–≤ ---
  const [resetCount, setResetCount] = useState(() => Number(localStorage.getItem('basil_reset_count')) || 0);
  const [lastResetDay, setLastResetDay] = useState(() => localStorage.getItem('basil_last_reset_day') || "");
  const [elixirExpire, setElixirExpire] = useState(() => Number(localStorage.getItem('basil_elixir_exp')) || 0);
  const [gardenerExpire, setGardenerExpire] = useState(() => Number(localStorage.getItem('basil_gardener_exp')) || 0);
  const [lastClickTime, setLastClickTime] = useState(() => Number(localStorage.getItem('basil_last_click')) || 0);
  const [currentTime, setCurrentTime] = useState(Date.now());
  
  // --- UI –°–æ—Å—Ç–æ—è–Ω–∏—è ---
  const [activeTab, setActiveTab] = useState('game');
  const [particles, setParticles] = useState([]);
  const [modal, setModal] = useState({ show: false, title: '', message: '', type: 'info', onConfirm: null });

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
  const isElixirActive = elixirExpire > currentTime;
  const isGardenerActive = gardenerExpire > currentTime;
  const todayStr = new Date().toDateString();
  const resetsToday = lastResetDay === todayStr ? resetCount : 0;

  // –î–∞–Ω–Ω—ã–µ –ª–∏–¥–µ—Ä–æ–≤
  const leaders = useMemo(() => [
    { name: "fichtenfuchs", points: 1540200, reward: "75 USDC", isKing: true },
    { name: "crypto_king", points: 1200500, reward: "40 USDC", isKing: true },
    { name: "base_master", points: 980000, reward: "25 USDC", isKing: false },
    { name: "YOU", points: Math.floor(points), reward: "5 USDC", isKing: isKing, isVip: isSupporter },
  ], [points, isKing, isSupporter]);

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
  useEffect(() => {
    const timer = setInterval(() => setCurrentTime(Date.now()), 1000);
    return () => clearInterval(timer);
  }, []);

  // –†–∞—Å—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –¥–æ —Å–æ–∑—Ä–µ–≤–∞–Ω–∏—è (—Ä–∞–∑ –≤ 24—á)
  const timeLeftMs = useMemo(() => {
    const nextAllowed = lastClickTime + DAY_IN_MS;
    return Math.max(0, nextAllowed - currentTime);
  }, [lastClickTime, currentTime]);

  const canHarvest = timeLeftMs === 0;

  // --- –õ–û–ì–ò–ö–ê –ê–í–¢–û-–°–ê–î–û–í–ù–ò–ö–ê ---
  useEffect(() => {
    if (isGardenerActive && canHarvest) {
      const waterBonus = [0, 2, 5, 12, 25, 60][autoWaterLevel] || (autoWaterLevel * 15);
      const currentMult = multiplier * (isKing ? 1.5 : 1) * (isElixirActive ? 2 : 1);
      const reward = (dailyRate + waterBonus) * currentMult;
      setPoints(prev => prev + reward);
      setLastClickTime(Date.now());
    }
  }, [currentTime, isGardenerActive, canHarvest]);

  // --- –õ–û–ì–ò–ö–ê –ü–ê–°–°–ò–í–ù–û–ì–û –î–û–•–û–î–ê ---
  useEffect(() => {
    const totalDaily = (dailyRate + (autoWaterLevel * 2)) * multiplier * (isKing ? 1.5 : 1) * (isElixirActive ? 2 : 1);
    const perSecond = totalDaily / DAY_IN_SECONDS;
    const interval = setInterval(() => setPoints(prev => prev + perSecond), 1000);
    return () => clearInterval(interval);
  }, [dailyRate, autoWaterLevel, multiplier, isKing, isElixirActive]);

  // --- –°–û–•–†–ê–ù–ï–ù–ò–ï ---
  useEffect(() => {
    const store = {
      basil_points: points,
      basil_daily_rate: dailyRate,
      basil_water_lvl: autoWaterLevel,
      basil_last_click: lastClickTime,
      basil_is_supporter: isSupporter,
      basil_is_king: isKing,
      basil_multiplier: multiplier,
      basil_elixir_exp: elixirExpire,
      basil_gardener_exp: gardenerExpire,
      basil_reset_count: resetCount,
      basil_last_reset_day: lastResetDay
    };
    Object.entries(store).forEach(([k, v]) => localStorage.setItem(k, v.toString()));
  }, [points, dailyRate, autoWaterLevel, lastClickTime, isSupporter, isKing, multiplier, elixirExpire, gardenerExpire, resetCount, lastResetDay]);

  // --- –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò ---
  const handleHarvestManual = (e) => {
    if (!canHarvest) return;
    const currentMult = multiplier * (isKing ? 1.5 : 1) * (isElixirActive ? 2 : 1);
    const reward = (dailyRate + (autoWaterLevel * 2)) * currentMult;
    setPoints(prev => prev + reward);
    setLastClickTime(Date.now());

    const clientX = (e.clientX || (e.touches && e.touches[0].clientX)) || window.innerWidth / 2;
    const clientY = (e.clientY || (e.touches && e.touches[0].clientY)) || window.innerHeight / 2;
    const id = Date.now();
    setParticles(prev => [...prev, { id, x: clientX, y: clientY, angle: Math.random() * 360 }]);
    setTimeout(() => setParticles(prev => prev.filter(p => p.id !== id)), 800);
  };

  const handlePurchase = (type, mode) => {
    const catalog = {
      fertilizer: { leaf: 50, donor: 0.50, title: '–ó–æ–ª–æ—Ç–æ–µ —É–¥–æ–±—Ä–µ–Ω–∏–µ', desc: '+1 üåø/—Å—É—Ç –Ω–∞–≤—Å–µ–≥–¥–∞' },
      elixir: { leaf: 30, donor: 0.20, title: '–≠–ª–∏–∫—Å–∏—Ä –°–∫–æ—Ä–æ—Å—Ç–∏', desc: '–ú–Ω–æ–∂–∏—Ç–µ–ª—å x2 –Ω–∞ –¥–æ—Ö–æ–¥ (3 –¥–Ω—è)' },
      gardener: { leaf: 40, donor: 0.25, title: '–ê–≤—Ç–æ-—Å–∞–¥–æ–≤–Ω–∏–∫', desc: '–ê–≤—Ç–æ-—Å–±–æ—Ä —É—Ä–æ–∂–∞—è (1 –Ω–µ–¥–µ–ª—è)' },
      rain: { leaf: 20, donor: 0.15, title: '–î–æ–∂–¥—å –∏–∑ –ë–∞–∑–∏–ª–∏–∫–∞', desc: '–®–∞–Ω—Å 10% –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ +5 üåø' },
      lootbox: { leaf: 15, donor: 0.05, title: '–ü–∞–∫–µ—Ç —Å–µ–º—è–Ω', desc: '–°–ª—É—á–∞–π–Ω—ã–π –ø—Ä–∏–∑: üåø –∏–ª–∏ –±—É—Å—Ç—ã' },
      king: { leaf: null, donor: 1.00, title: '–ö–æ—Ä–æ–ª—å –§–µ—Ä–º–µ—Ä–æ–≤', desc: '–ó–æ–ª–æ—Ç–∞—è —Ä–∞–º–∫–∞ + x1.5 –±–æ–Ω—É—Å' },
      reset: { donor: 0.30, title: '–°–±—Ä–æ—Å —Ç–∞–π–º–µ—Ä–∞' }
    };

    const item = catalog[type];
    const cost = mode === 'leaf' ? item.leaf : item.donor;

    // –õ–∏–º–∏—Ç –Ω–∞ —Å–±—Ä–æ—Å
    if (type === 'reset' && resetsToday >= 2) {
      setModal({ show: true, title: '–õ–∏–º–∏—Ç –∏—Å—á–µ—Ä–ø–∞–Ω', message: '–°–±—Ä–∞—Å—ã–≤–∞—Ç—å —Ç–∞–π–º–µ—Ä –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ 2 —Ä–∞–∑–∞ –≤ —Å—É—Ç–∫–∏.', type: 'info' });
      return;
    }

    if (mode === 'leaf' && (item.leaf === null || points < cost)) {
      setModal({ show: true, title: '–ù—É–∂–Ω–æ –±–æ–ª—å—à–µ –ª–∏—Å—Ç—å–µ–≤', message: `–í–∞–º –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç ${Math.ceil(cost - points)} üåø –¥–ª—è –ø–æ–∫—É–ø–∫–∏.`, type: 'info' });
      return;
    }

    setModal({
      show: true,
      title: '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ',
      message: `–í—ã —Ö–æ—Ç–∏—Ç–µ –ø—Ä–∏–æ–±—Ä–µ—Å—Ç–∏ "${item.title}" –∑–∞ ${cost} ${mode === 'leaf' ? 'üåø' : 'USDC'}?`,
      type: 'confirm',
      onConfirm: () => {
        if (mode === 'leaf') setPoints(p => p - cost);
        if (mode === 'donor') setIsSupporter(true);

        if (type === 'fertilizer') setDailyRate(r => r + 1);
        if (type === 'elixir') setElixirExpire(Date.now() + (3 * DAY_IN_MS));
        if (type === 'gardener') setGardenerExpire(Date.now() + (7 * DAY_IN_MS));
        if (type === 'king') setIsKing(true);
        if (type === 'reset') {
          setLastClickTime(0);
          if (lastResetDay === todayStr) {
            setResetCount(prev => prev + 1);
          } else {
            setLastResetDay(todayStr);
            setResetCount(1);
          }
        }
        if (type === 'rain') {
          if (Math.random() < 0.1) {
            setPoints(p => p + 5);
            setModal({ show: true, title: '–£–†–ê!', message: '–ü–æ—à–µ–ª –¥–æ–∂–¥—å! –í—ã –ø–æ–ª—É—á–∏–ª–∏ +5 üåø —Å—Ä–∞–∑—É!', type: 'info' });
          } else {
            setModal({ show: true, title: '–ü—É—Å—Ç–æ', message: '–¢—É—á–∏ –ø—Ä–æ—à–ª–∏ –º–∏–º–æ, –¥–æ–∂–¥—è –Ω–µ —Å–ª—É—á–∏–ª–æ—Å—å.', type: 'info' });
          }
          return;
        }
        if (type === 'lootbox') {
          const rand = Math.random() * 100;
          if (rand < 1) { setPoints(p => p + 100); setModal({ show: true, title: '–õ–ï–ì–ï–ù–î–ê–†–ù–û!', message: '–í—ã –Ω–∞—à–ª–∏ 100 üåø!', type: 'info' }); }
          else if (rand < 10) { setElixirExpire(Date.now() + DAY_IN_MS); setModal({ show: true, title: '–≠–ü–ò–ö!', message: '–≠–ª–∏–∫—Å–∏—Ä x2 –Ω–∞ 24 —á–∞—Å–∞!', type: 'info' }); }
          else if (rand < 30) { const win = Math.floor(Math.random() * 11) + 10; setPoints(p => p + win); setModal({ show: true, title: '–†–ï–î–ö–û–°–¢–¨', message: `–í–Ω—É—Ç—Ä–∏ –±—ã–ª–æ ${win} üåø!`, type: 'info' }); }
          else { const win = Math.floor(Math.random() * 4) + 2; setPoints(p => p + win); setModal({ show: true, title: '–û–±—ã—á–Ω—ã–π —É–ª–æ–≤', message: `–í—ã –Ω–∞—à–ª–∏ ${win} üåø.`, type: 'info' }); }
          return;
        }
        setModal({ show: false });
      }
    });
  };

  const formatTimeFull = (ms) => {
    const hours = Math.floor(ms / (1000 * 60 * 60));
    const minutes = Math.floor((ms / (1000 * 60)) % 60);
    const seconds = Math.floor((ms / 1000) % 60);
    return `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
  };

  return (
    <div className="min-h-screen bg-[#F9FBF9] text-slate-900 flex flex-col items-center select-none font-sans overflow-hidden">
      
      {/* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */}
      {modal.show && (
        <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
          <div className="bg-white rounded-[32px] p-6 w-full max-w-xs shadow-2xl text-center scale-in-center">
            <h3 className="font-black text-lg mb-2">{modal.title}</h3>
            <p className="text-sm text-slate-500 mb-6 leading-snug">{modal.message}</p>
            <div className="flex flex-col gap-2">
              {modal.type === 'confirm' ? (
                <>
                  <button onClick={modal.onConfirm} className="w-full py-4 rounded-2xl bg-blue-600 text-white font-black shadow-lg active:scale-95 transition-transform">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
                  <button onClick={() => setModal({ show: false })} className="w-full py-3 text-slate-400 font-bold text-xs">–û—Ç–º–µ–Ω–∞</button>
                </>
              ) : (
                <button onClick={() => setModal({ show: false })} className="w-full py-4 rounded-2xl bg-slate-900 text-white font-black">–ü–æ–Ω—è—Ç–Ω–æ</button>
              )}
            </div>
          </div>
        </div>
      )}

      {/* –®–∞–ø–∫–∞ */}
      <header className="w-full max-w-md bg-white border-b border-slate-100 p-4 flex justify-between items-center sticky top-0 z-50">
        <div className="flex items-center gap-2">
          <div className="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold border-2 border-white shadow-sm shrink-0">B</div>
          <div className="flex items-center gap-1 font-black">Base <span className="text-red-500 flex items-center italic">Like <Heart size={14} className="fill-red-500 ml-0.5" /></span></div>
        </div>
        <div className="bg-green-50 px-3 py-1.5 rounded-full border border-green-100 flex items-center gap-2">
           <Leaf size={14} className="text-green-600" />
           <span className="text-xs font-black text-green-700">{Math.floor(points).toLocaleString()}</span>
        </div>
      </header>

      <main className="flex-1 w-full max-w-md relative flex flex-col overflow-y-auto pb-24 text-center">
        
        {/* –≠–∫—Ä–∞–Ω –°–±–æ—Ä–∞ */}
        {activeTab === 'game' && (
          <div className="flex flex-col items-center pt-8 px-6">
            <div className="mb-6 relative">
              {isKing && <div className="absolute -top-4 left-1/2 -translate-x-1/2 bg-yellow-400 text-white px-3 py-0.5 rounded-full text-[8px] font-black uppercase tracking-widest shadow-sm">King</div>}
              <div className="text-6xl font-black text-slate-900 tracking-tight">{Math.floor(points).toLocaleString()}</div>
            </div>

            <div className="relative mb-4 flex items-center justify-center w-full max-w-[280px] aspect-square">
              <div className={`absolute inset-0 rounded-full blur-[80px] transition-all duration-1000 ${canHarvest ? 'bg-green-300 opacity-40' : 'bg-blue-200 opacity-20'}`}></div>
              <div onClick={handleHarvestManual} className={`relative transform transition-all duration-500 ${canHarvest ? 'active:scale-90 cursor-pointer' : 'opacity-60 grayscale-[0.3]'}`}>
                 <BasilPlantSVG />
                 {!canHarvest && !isGardenerActive && (
                   <div className="absolute inset-0 flex items-center justify-center">
                     <div className="bg-white/80 backdrop-blur-sm p-5 rounded-full shadow-2xl">
                       <Clock size={40} className="text-blue-500 animate-pulse" />
                     </div>
                   </div>
                 )}
                 {isGardenerActive && !canHarvest && (
                    <div className="absolute top-0 right-0 bg-blue-600 text-white p-2 rounded-full border-2 border-white shadow-lg scale-in-center">
                       <Bot size={20} />
                    </div>
                 )}
              </div>
            </div>

            <div className="w-full max-w-[240px] mb-8">
              {canHarvest ? (
                <button onClick={handleHarvestManual} className="w-full bg-green-500 text-white font-black py-5 rounded-[24px] shadow-xl animate-bounce uppercase text-sm tracking-widest">–°–æ–±—Ä–∞—Ç—å üåø</button>
              ) : (
                <div className="space-y-4">
                  <div className="bg-white border border-slate-100 p-5 rounded-[32px] shadow-sm">
                    <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1">{isGardenerActive ? '–°–∞–¥–æ–≤–Ω–∏–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç' : '–î–æ —Å–æ–∑—Ä–µ–≤–∞–Ω–∏—è'}</p>
                    <div className="text-2xl font-mono font-black text-blue-600">{formatTimeFull(timeLeftMs)}</div>
                  </div>
                  
                  <button 
                    onClick={() => handlePurchase('reset', 'donor')} 
                    disabled={resetsToday >= 2}
                    className={`w-full font-black py-3 rounded-xl border text-[10px] uppercase flex items-center justify-center gap-2 active:scale-95 transition-all ${
                      resetsToday < 2 
                        ? 'bg-blue-50 text-blue-600 border-blue-100 hover:bg-blue-100' 
                        : 'bg-slate-50 text-slate-400 border-slate-100 cursor-not-allowed'
                    }`}
                  >
                    <Zap size={14} className={resetsToday < 2 ? "fill-blue-600" : "fill-slate-400"} /> 
                    –°–±—Ä–æ—Å —Ç–∞–π–º–µ—Ä–∞ {resetsToday}/2 ($0.30)
                  </button>
                </div>
              )}
            </div>

            <div className="flex gap-2 flex-wrap justify-center">
               {isElixirActive && <div className="bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-[9px] font-black flex items-center gap-1 shadow-sm border border-purple-200 animate-pulse"><Zap size={10} /> –≠–ª–∏–∫—Å–∏—Ä x2</div>}
               {isGardenerActive && <div className="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-[9px] font-black flex items-center gap-1 shadow-sm border border-blue-200"><Bot size={10} /> –°–∞–¥–æ–≤–Ω–∏–∫</div>}
            </div>
          </div>
        )}

        {/* –≠–∫—Ä–∞–Ω –ú–∞—Ä–∫–µ—Ç–∞ */}
        {activeTab === 'shop' && (
          <div className="p-6 text-left">
            <h2 className="text-2xl font-black mb-6 flex items-center gap-2 tracking-tight">
              <ShoppingCart size={28} className="text-red-500" /> –ú–∞—Ä–∫–µ—Ç
            </h2>
            
            <div className="space-y-4">
              <MarketCard 
                icon={<Box className="text-orange-500" />}
                title="–ü–∞–∫–µ—Ç —Å–µ–º—è–Ω (Lootbox)"
                desc="–®–∞–Ω—Å –Ω–∞ 100 üåø, –≠–ª–∏–∫—Å–∏—Ä x2 –∏–ª–∏ –ø–∞—á–∫–∏ –ª–∏—Å—Ç—å–µ–≤."
                leafCost={15}
                donorCost={0.05}
                onLeaf={() => handlePurchase('lootbox', 'leaf')}
                onDonor={() => handlePurchase('lootbox', 'donor')}
                isNew
              />
              <MarketCard 
                icon={<Star className="text-yellow-500" />}
                title="–ó–æ–ª–æ—Ç–æ–µ —É–¥–æ–±—Ä–µ–Ω–∏–µ"
                desc="+1 üåø –∫ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–º—É —Å–±–æ—Ä—É –ù–ê–í–°–ï–ì–î–ê."
                leafCost={50}
                donorCost={0.50}
                onLeaf={() => handlePurchase('fertilizer', 'leaf')}
                onDonor={() => handlePurchase('fertilizer', 'donor')}
              />
              <MarketCard 
                icon={<Zap className="text-purple-500" />}
                title="–≠–ª–∏–∫—Å–∏—Ä –°–∫–æ—Ä–æ—Å—Ç–∏"
                desc="–ú–Ω–æ–∂–∏—Ç–µ–ª—å x2 –Ω–∞ –≤–µ—Å—å –¥–æ—Ö–æ–¥ (3 –¥–Ω—è)."
                leafCost={30}
                donorCost={0.20}
                onLeaf={() => handlePurchase('elixir', 'leaf')}
                onDonor={() => handlePurchase('elixir', 'donor')}
              />
              <MarketCard 
                icon={<Bot className="text-blue-500" />}
                title="–ê–≤—Ç–æ-—Å–∞–¥–æ–≤–Ω–∏–∫"
                desc="–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä —É—Ä–æ–∂–∞—è (1 –Ω–µ–¥–µ–ª—è)."
                leafCost={40}
                donorCost={0.25}
                onLeaf={() => handlePurchase('gardener', 'leaf')}
                onDonor={() => handlePurchase('gardener', 'donor')}
              />
              <MarketCard 
                icon={<Gift className="text-orange-500" />}
                title="–î–æ–∂–¥—å –∏–∑ –ë–∞–∑–∏–ª–∏–∫–∞"
                desc="–ê–∑–∞—Ä—Ç: 10% —à–∞–Ω—Å —Å—Ä–∞–∑—É –ø–æ–ª—É—á–∏—Ç—å +5 üåø."
                leafCost={20}
                donorCost={0.15}
                onLeaf={() => handlePurchase('rain', 'leaf')}
                onDonor={() => handlePurchase('rain', 'donor')}
              />
              <div className="bg-gradient-to-br from-yellow-400 to-orange-500 p-5 rounded-[32px] text-white shadow-lg relative overflow-hidden">
                <div className="relative z-10">
                  <h3 className="font-black flex items-center gap-2 text-lg"><Crown size={20} /> –ö–æ—Ä–æ–ª—å –§–µ—Ä–º–µ—Ä–æ–≤</h3>
                  <p className="text-[11px] font-bold opacity-90 mt-1">–ó–æ–ª–æ—Ç–∞—è —Ä–∞–º–∫–∞ + x1.5 –∫–æ –≤—Å–µ–º—É –¥–æ—Ö–æ–¥—É!</p>
                  <button onClick={() => handlePurchase('king', 'donor')} className="mt-4 w-full bg-white text-orange-600 font-black py-3 rounded-2xl active:scale-95 text-[10px] tracking-widest shadow-md">
                    –¢–û–õ–¨–ö–û –î–û–ù–ê–¢ ($1.00)
                  </button>
                </div>
                <Sparkles size={80} className="absolute -right-4 -bottom-4 text-white/20 opacity-30" />
              </div>
            </div>
          </div>
        )}

        {/* –≠–∫—Ä–∞–Ω –¢–æ–ø–∞ */}
        {activeTab === 'leaderboard' && (
          <div className="p-6 text-left">
            <div className="bg-slate-900 rounded-[32px] p-6 text-white mb-6">
              <h2 className="text-lg font-black flex items-center gap-2"><Trophy size={22} className="text-yellow-400" /> –¢–æ–ø –ú–µ—Å—è—Ü–∞</h2>
              <p className="text-xs text-slate-400 mt-1 italic">–ü—Ä–∏–∑: 150 USDC –∑–∞ 1 –º–µ—Å—Ç–æ</p>
            </div>
            <div className="bg-white rounded-[32px] shadow-sm border border-slate-100 overflow-hidden">
              {leaders.map((l, i) => (
                <div key={i} className={`flex justify-between p-5 border-b border-slate-50 last:border-0 items-center ${l.isKing ? 'bg-yellow-50/50' : ''}`}>
                   <div className="flex flex-col">
                     <span className={`font-black text-slate-800 ${l.isKing ? 'text-yellow-700' : ''}`}>{i+1}. {l.name}</span>
                     <span className="text-[10px] text-slate-400 font-bold uppercase tracking-tighter">{l.points.toLocaleString()} üåø</span>
                   </div>
                   <span className="font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded-lg text-xs">{l.reward}</span>
                </div>
              ))}
            </div>
          </div>
        )}

        {/* –ß–∞—Å—Ç–∏—Ü—ã */}
        {particles.map(p => (
          <div key={p.id} className="fixed pointer-events-none z-[60] text-3xl animate-leaf-float" style={{ left: p.x, top: p.y, transform: `rotate(${p.angle}deg)` }}>üåø</div>
        ))}
      </main>

      {/* –ù–∞–≤–∏–≥–∞—Ü–∏—è */}
      <nav className="fixed bottom-0 w-full max-w-md bg-white border-t border-slate-100 flex justify-around p-4 shadow-2xl backdrop-blur-xl bg-white/90 z-50">
        <NavButton active={activeTab === 'game'} icon={<Leaf size={24} />} label="–°–±–æ—Ä" onClick={() => setActiveTab('game')} />
        <NavButton active={activeTab === 'shop'} icon={<ShoppingCart size={24} />} label="–ú–∞—Ä–∫–µ—Ç" onClick={() => setActiveTab('shop')} />
        <NavButton active={activeTab === 'leaderboard'} icon={<Trophy size={24} />} label="–¢–æ–ø" onClick={() => setActiveTab('leaderboard')} />
      </nav>

      <style dangerouslySetInnerHTML={{ __html: `
        @keyframes leaf-float {
          0% { transform: translateY(0) rotate(0deg) scale(1.5); opacity: 1; }
          100% { transform: translateY(-120px) rotate(90deg) scale(0); opacity: 0; }
        }
        .animate-leaf-float { animation: leaf-float 0.8s cubic-bezier(0.18, 0.89, 0.32, 1.28) forwards; }
        .scale-in-center { animation: scale-in-center 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94) both; }
        @keyframes scale-in-center { 0% { transform: scale(0); opacity: 1; } 100% { transform: scale(1); opacity: 1; } }
      `}} />
    </div>
  );
};

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã UI
const NavButton = ({ active, icon, label, onClick }) => (
  <button onClick={onClick} className={`flex flex-col items-center gap-1 transition-all duration-300 ${active ? 'text-blue-600 scale-110 font-black' : 'text-slate-400'}`}>
    <div className={`${active ? 'drop-shadow-[0_0_12px_rgba(37,99,235,0.4)]' : ''}`}>{icon}</div>
    <span className={`text-[10px] font-black uppercase tracking-widest ${active ? 'opacity-100' : 'opacity-50'}`}>{label}</span>
  </button>
);

const MarketCard = ({ icon, title, desc, leafCost, donorCost, onLeaf, onDonor, isNew }) => (
  <div className={`bg-white border ${isNew ? 'border-orange-200 bg-orange-50/20' : 'border-slate-100'} p-5 rounded-[32px] shadow-sm relative overflow-hidden`}>
    <div className="flex items-center gap-4 mb-4 text-left">
      <div className={`w-12 h-12 ${isNew ? 'bg-orange-100' : 'bg-slate-50'} rounded-2xl flex items-center justify-center shrink-0`}>{icon}</div>
      <div>
        <h3 className="text-sm font-black text-slate-800 leading-tight">{title}</h3>
        <p className="text-[10px] text-slate-400 font-bold mt-0.5">{desc}</p>
      </div>
    </div>
    <div className="grid grid-cols-2 gap-2">
       <button onClick={onLeaf} className="flex flex-col items-center justify-center p-2 rounded-2xl bg-green-50 border border-green-100 active:scale-95 transition-all">
         <span className="text-xs font-black text-green-700">{leafCost} üåø</span>
       </button>
       <button onClick={onDonor} className="flex flex-col items-center justify-center p-2 rounded-2xl bg-blue-50 border border-blue-100 active:scale-95 transition-all">
         <span className="text-xs font-black text-blue-700">${donorCost.toFixed(2)}</span>
       </button>
    </div>
  </div>
);

export default App;